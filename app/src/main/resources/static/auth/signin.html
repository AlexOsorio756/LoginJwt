<!DOCTYPE html>
<html>
<head>
    <title>Sign in</title>
    <style>
        body { font-family: sans-serif; display: flex; justify-content: center; padding-top: 50px; }
        form { border: 1px solid #ccc; padding: 20px; display: flex; flex-direction: column; gap: 10px; }
    </style>
</head>
<body>
    <form id="signInForm">
        <h2>Create account</h2>
        <input type="text" id="user" placeholder="Username" required>
        <input type="email" id="email" placeholder="Email" required>
        <button type="submit">Sign in</button>
        <a href="login.html">Already have an account</a>
    </form>

    <script>
        document.getElementById('signInForm').onsubmit = async (e) => {
    e.preventDefault();
    
    const userToSignIn = {
        email: document.getElementById('email').value,
        username: document.getElementById('user').value
    };

    const response = await fetch('/api/users/signin', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(userToSignIn)
    });

    if (response.ok) {
        const createdUser = await response.json();
        const token = createdUser.token; 
        
        // Creamos el enlace para probar
        const simulatedLink = `http://localhost:8080/auth/confirm.html?token=${token}`;
        
        // Por si falla mailtrap o algo asi podemos ver el link en este html
        document.body.innerHTML = `
            <div style="padding: 50px; text-align: center; font-family: sans-serif;">
                <h2 style="color: green;"Sign in successfully!</h2>
                <p>Normaly this will appear in your mail, but click here to continue:</p>
                <a href="${simulatedLink}" style="font-size: 20px; font-weight: bold;">
                   CONFIRM MY ACCOUNT AND PASSWORD
                </a>
                <p style="color: gray; font-size: 12px; margin-top: 20px;">Token generated: ${token}</p>
            </div>
        `;
    } else {
        alert("Error in sign in. Check java console.");
    }
};
    </script>
</body>
</html>