<!DOCTYPE html>
<html>
<body>
    <h2>Create your password</h2>
    <input type="password" id="newPassword" placeholder="New Password">
    <button onclick="send()">Active my account</button>

    <script>
        async function send() {
    const urlParams = new URLSearchParams(window.location.search);
    const token = urlParams.get('token');
    const pass = document.getElementById('newPassword').value;

    const response = await fetch('/api/users/confirm', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ token: token, password: pass })
    });

    if (response.ok) {
        alert("Account activated! Now you can log in.");
        window.location.href = "/auth/login.html";
    } else {
        const errorData = await response.json();
        document.body.innerHTML = `
            <div style="color: red; text-align: center; margin-top: 100px;">
                <h2>Activation Error</h2>
                <p>${errorData.error || "This link is no longer valid."}</p>
                <a href="/auth/registro.html">Try registering again</a>
            </div>
        `;
    }
}
    </script>
</body>
</html>